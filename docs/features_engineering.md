# 增强版航班排名特征工程指南

## 1. 特征工程总体策略

### 1.1 核心原则

* **业务导向** : 每个特征都应反映商务旅行者的真实决策因素
* **排名优化** : 所有特征都应针对组内排名问题进行设计
* **信息密度** : 优先构建信息密度高的复合特征，减少特征维度
* **泛化能力** : 避免过度拟合特定路线或时间段的模式

### 1.2 特征构建层次

1. **原始特征清洗** - 处理缺失值、异常值、数据类型转换
2. **基础衍生特征** - 时间提取、编码转换、简单计算
3. **组内相对特征** - 在ranker_id组内的相对位置和排名
4. **复合业务特征** - 结合多个维度的业务逻辑特征
5. **交互特征** - 特征间的非线性组合
6. **高阶统计特征** - 用户/路线级别的历史统计特征

## 2. 核心特征组重构与增强

### 2.1 用户画像特征组 (User Profile Features)

#### 原始特征

* `profileId`, `sex`, `nationality`, `frequentFlyer`, `isVip`, `bySelf`, `isAccess3D`

#### 增强策略

**用户类型识别**

* 构建复合用户画像：商务精英型、成本敏感型、便利优先型、服务导向型
* 基于多维度特征的用户聚类标签
* 用户成熟度评分（基于频繁飞行状态和VIP状态）

**用户偏好建模**

* 用户历史选择模式统计（需要跨时间段的历史数据）
* 用户行为一致性评分
* 用户价格敏感度指标

**地理文化特征**

* 国籍对应的文化维度特征（时间偏好、服务期望）
* 地理时区偏好影响
* 语言文化群体分类

### 2.2 企业差旅特征组 (Corporate Travel Features)

#### 原始特征

* `companyID`, `corporateTariffCode`, `pricingInfo_isAccessTP`

#### 增强策略

**企业政策建模**

* 企业规模分层（基于companyID出现频率）
* 企业差旅政策严格程度评分
* 企业行业分类推断（基于差旅模式）

**政策合规性特征**

* 政策范围内的选择多样性评分
* 政策外溢价承受度
* 企业预算弹性指标

**企业行为模式**

* 企业常用路线偏好
* 企业时间偏好模式
* 企业服务等级要求

### 2.3 时间维度特征组 (Temporal Features)

#### 原始特征

* `requestDate`, `legs0_departureAt`, `legs0_arrivalAt`, `legs1_departureAt`, `legs1_arrivalAt`

#### 增强策略

**预订时机特征**

* 提前预订天数及其对应的价格弹性
* 预订时机与商务旅行紧急程度关系
* 预订时间与最优价格窗口的偏离度

**出行时间偏好**

* 商务友好时间段识别（早班、晚班偏好）
* 跨时区旅行的时差适应性评分
* 周期性模式（周几效应、月份效应）

**时间效率特征**

* 总旅行时间与最短可能时间的比率
* 在目的地的有效时间占比
* 时间浪费系数（等待、转机时间）

**时间一致性特征**

* 往返时间对称性评分
* 出行时间与用户历史偏好的匹配度
* 商务时间窗口命中率

### 2.4 价格与成本特征组 (Pricing & Cost Features)

#### 原始特征

* `totalPrice_bin`, `taxes_bin`, `pricingInfo_passengerCount`

#### 增强策略

**价格竞争力特征**

* 组内价格排名百分位
* 相对于市场基准价格的偏离度
* 价格-时间效率综合评分

**成本结构分析**

* 基础票价与附加费用比例
* 税费占比及其合理性
* 隐性成本识别（行李费、改签费等）

**价值主张特征**

* 性价比综合评分
* 单位时间成本
* 单位便利性成本

**价格敏感性建模**

* 用户价格容忍度评估
* 企业预算约束影响
* 价格弹性系数

### 2.5 航线复杂度特征组 (Route Complexity Features)

#### 原始特征

* 所有 `legs*_segments*`相关特征

#### 增强策略

**航线结构特征**

* 航线复杂度评分（直飞=1，一次转机=2，多次转机=3+）
* 转机效率评分（转机时间与最小转机时间的比较）
* 航线一致性评分（往返是否使用相同航线）

**地理便利性特征**

* 主要机场vs支线机场偏好
* 机场便利性综合评分（交通、设施、服务）
* 地理距离效率（实际距离与直线距离比）

**航空公司网络特征**

* 主承运商网络覆盖度
* 航空公司可靠性评分
* 代码共享复杂度

**中转体验特征**

* 中转机场服务质量评分
* 中转时间合理性评估
* 行李直挂可能性

### 2.6 服务等级特征组 (Service Level Features)

#### 原始特征

* `legs*_segments*_cabinClass`, `legs*_segments*_seatsAvailable`, `legs*_segments*_baggageAllowance_*`

#### 增强策略

**舱位价值建模**

* 舱位升级价值评估
* 舱位一致性评分（全程舱位统一性）
* 舱位与用户身份匹配度

**座位稀缺性特征**

* 座位供需紧张度指标
* 座位选择灵活性评分
* 满座风险评估

**行李政策特征**

* 行李政策友好度评分
* 行李限制与商务需求匹配度
* 额外行李费用风险

**服务一致性特征**

* 全程服务标准一致性
* 服务等级与价格匹配度
* 服务升级机会评估

### 2.7 灵活性与政策特征组 (Flexibility & Policy Features)

#### 原始特征

* `miniRules0_*`, `miniRules1_*`相关特征

#### 增强策略

**改签灵活性建模**

* 改签难度评分（费用+限制条件）
* 改签政策友好度排名
* 紧急变更适应性

**取消政策价值**

* 取消保险价值评估
* 取消风险覆盖度
* 政策透明度评分

**政策复杂度特征**

* 规则理解难度评分
* 政策执行一致性
* 客户友好度综合评分

**风险管理特征**

* 商务旅行风险覆盖度
* 政策保护价值
* 意外变更适应能力

## 3. 高级复合特征构建

### 3.1 商务友好度综合评分

**时间友好度**

* 出发时间商务适宜性（7-10点，17-20点为佳）
* 到达时间便利性（避免深夜到达）
* 总旅行时间效率

**服务友好度**

* 舱位等级与商务需求匹配
* 航空公司服务质量
* 机场设施便利性

**政策友好度**

* 改签取消政策灵活性
* 企业政策合规性
* 费用透明度

### 3.2 性价比综合指标

**直接性价比**

* 价格相对于服务等级的合理性
* 时间成本与金钱成本的平衡
* 便利性溢价的合理性

**隐性价值**

* 风险管理价值
* 时间节省价值
* 舒适度提升价值

### 3.3 用户匹配度评分

**历史偏好匹配**

* 与用户历史选择模式的相似度
* 用户行为预测一致性
* 个性化推荐适配度

**企业政策匹配**

* 企业差旅政策符合度
* 预算约束满足度
* 审批通过可能性

### 3.4 竞争优势特征

**组内相对优势**

* 各维度相对排名的加权组合
* 多目标优化下的帕累托最优性
* 综合竞争力排名

**绝对优势识别**

* 独特卖点识别
* 不可替代性评分
* 差异化优势量化

## 4. 特征交互与组合策略

### 4.1 二阶交互特征

**用户-价格交互**

* 用户类型与价格敏感度的交互
* VIP状态与价格容忍度的关系
* 企业规模与预算弹性的交互

**时间-价格交互**

* 预订时机与价格优势的交互
* 出行时间与价格溢价的关系
* 紧急程度与价格接受度的交互

**服务-价格交互**

* 舱位等级与价格合理性的交互
* 航空公司品牌与价格期望的关系
* 服务等级与价格敏感度的交互

### 4.2 三阶及高阶交互

**用户-时间-价格三元交互**

* 不同用户类型在不同时间段的价格偏好
* 商务紧急度、时间偏好、价格容忍度的复合影响

**服务-政策-价格三元交互**

* 服务等级、灵活性政策、价格的综合价值评估

### 4.3 条件特征构建

**场景化特征**

* 紧急出行场景下的特征权重调整
* 成本控制场景下的特征重要性重排
* 舒适性优先场景下的特征组合

## 5. 特征降维与选择策略

### 5.1 信息密度优化

**主成分分析应用**

* 高相关特征组的主成分提取
* 特征空间降维与信息保留平衡

**因子分析建模**

* 潜在因子识别（价格因子、便利性因子、服务因子）
* 因子载荷分析与解释

### 5.2 特征重要性评估

**业务重要性评估**

* 商务旅行决策因子的权重分析
* 不同用户群体的特征重要性差异

**统计重要性验证**

* 特征与目标变量的相关性分析
* 特征稳定性与一致性检验

**模型重要性分析**

* 树模型的特征重要性排序
* 深度学习模型的注意力权重分析

### 5.3 特征组合优化

**递归特征消除**

* 基于交叉验证的特征选择
* 特征冗余度评估与去除

**前向特征选择**

* 基于业务逻辑的特征添加顺序
* 边际贡献度评估

## 6. 特征工程质量保证

### 6.1 数据质量监控

**一致性检查**

* 跨特征的逻辑一致性验证
* 异常值检测与处理策略

**完整性评估**

* 缺失值模式分析
* 缺失值填补策略优化

### 6.2 特征稳定性分析

**时间稳定性**

* 特征分布的时间变化趋势
* 季节性和周期性模式识别

**群体稳定性**

* 不同用户群体间的特征分布差异
* 特征泛化能力评估

## 7. 特征工程实施路径

### 7.1 分阶段实施策略

**第一阶段：基础特征构建**

* 原始特征清洗和基本衍生
* 组内相对特征计算
* 基础业务逻辑特征构建

**第二阶段：高级特征开发**

* 复合特征和综合评分构建
* 二阶交互特征开发
* 用户和企业级统计特征

**第三阶段：特征优化与选择**

* 特征重要性分析和选择
* 特征组合优化
* 模型适配性调整

### 7.2 迭代优化流程

**特征效果评估**

* 基于HitRate@3指标的特征贡献度分析
* 特征边际效益评估
* 计算成本与效果的权衡

**持续优化机制**

* 基于模型反馈的特征调整
* 新业务场景下的特征扩展
* 特征工程自动化程度提升

## 8. 特征工程最佳实践*

### 8.1 可解释性原则

**业务可解释性**

* 每个特征都应有清晰的业务含义
* 特征与商务旅行决策逻辑的对应关系
* 特征效果的直观解释

**技术可解释性**

* 特征构建过程的可追溯性
* 特征计算逻辑的透明性
* 特征异常情况的处理机制

### 8.2 扩展性设计

**新数据适应性**

* 特征工程流程对新数据的适应能力
* 特征定义的标准化和文档化
* 特征计算的模块化设计

**模型兼容性**

* 特征格式对不同模型的适配性
* 特征尺度和分布的标准化
* 特征工程与模型训练的解耦设计

### 8.3 性能优化

**计算效率**

* 特征计算的时间复杂度优化
* 并行计算和分布式处理
* 特征缓存和复用策略

**存储效率**

* 特征数据的压缩和存储优化
* 稀疏特征的有效表示
* 特征版本管理和追踪

## 9. 总结与展望

### 9.1 核心价值

本特征工程指南通过深度理解商务旅行者的决策逻辑，构建了一套全面的特征体系，旨在：

* **提升预测准确性** ：通过精细化的特征工程提高HitRate@3指标
* **增强业务价值** ：确保特征工程与实际商务场景的紧密结合
* **保证可扩展性** ：为未来的模型升级和业务扩展提供基础

### 9.2 持续改进方向

* **实时特征集成** ：集成市场动态、天气、政策变化等实时信息
* **深度个性化** ：基于更丰富的用户行为数据构建个性化特征
* **跨域特征融合** ：集成酒店、地面交通等相关领域信息
* **自动化特征发现** ：使用机器学习方法自动发现有效特征组合

通过系统性的特征工程实施，预期能够显著提升航班排名模型的性能，为商务旅行者提供更精准的个性化推荐服务。
