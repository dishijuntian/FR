# 航班排名竞赛研究框架

## 竞赛概述

 **目标** : 构建智能航班排名模型，预测商务旅行者从搜索结果中选择的航班选项。

 **问题类型** : 分组排名问题，模型需要在每个用户搜索会话中对航班选项进行排名。

 **评估指标** : HitRate@3 - 正确航班出现在前3个预测中的搜索会话比例（仅针对超过10个选项的组）。

## 项目架构与工作流程

### 阶段1: 数据理解与探索

#### 1.1 数据集结构分析

* **主要文件** : `train.parquet`, `test.parquet`, `sample_submission.parquet`
* **原始数据** : `jsons_raw.tar.kaggle` (15万个JSON文件，约50GB)
* **关键标识符** : `ranker_id` (搜索会话分组变量)
* **目标变量** : `selected` (训练集中为二进制表示是否被选择，提交时为排名1,2,3...表示选择优先级)

#### 1.2 数据探索任务

* [ ] 加载并检查数据集维度
* [ ] 分析 `ranker_id` 组大小分布
* [ ] 理解不同细分市场的用户行为模式
* [ ] 探索航班特征分布
* [ ] 识别缺失数据模式
* [ ] 验证数据一致性规则

#### 1.3 业务逻辑理解

* [ ] 分析商务旅行者与休闲旅行者偏好差异
* [ ] 理解企业差旅政策影响
* [ ] 检查航线复杂性（直飞vs中转）
* [ ] 研究定价结构和票价规则
* [ ] 调查时间偏好模式

### 阶段2: 特征工程

#### 2.1 时间特征

* [ ] 从起飞/到达时间提取基于时间的模式
* [ ] 计算提前预订时间窗口
* [ ] 创建星期几、一天中的小时特征
* [ ] 构建旅行时长效率指标

#### 2.2 定价特征

* [ ] 按路线和日期标准化价格
* [ ] 创建搜索会话内价格排名
* [ ] 计算性价比指标
* [ ] 分析企业政策合规性影响

#### 2.3 路线与航空公司特征

* [ ] 编码机场和城市偏好
* [ ] 创建航空公司偏好分数
* [ ] 构建路线复杂性指标（中转、经停）
* [ ] 计算地理便利性因子

#### 2.4 用户档案特征

* [ ] 编码用户人口统计和偏好
* [ ] 创建常旅客状态指标
* [ ] 构建企业归属特征
* [ ] 分析历史预订模式

#### 2.5 航班特征

* [ ] 机型偏好
* [ ] 舱位等级价值主张
* [ ] 座位可用性指标
* [ ] 行李限额竞争力

#### 2.6 灵活性特征

* [ ] 取消政策吸引力
* [ ] 更改规则灵活性评分
* [ ] 退款政策竞争力

### 阶段3: 模型开发

#### 3.1 基线模型

* [ ] **基于价格的排名** : 简单价格排序
* [ ] **基于时长的排名** : 航班时间优化
* [ ] **起飞时间排名** : 时间偏好建模
* [ ] **复合规则基** : 加权组合

#### 3.2 机器学习方法

##### 3.2.1 逐点方法

* [ ] **逻辑回归** : 二元分类 → 排名
* [ ] **随机森林** : 特征重要性分析
* [ ] **XGBoost** : 选择概率梯度提升
* [ ] **LightGBM** : 高效梯度提升

##### 3.2.2 成对方法

* [ ] **RankNet** : 神经网络成对排名
* [ ] **LambdaRank** : 针对排名指标优化
* [ ] **成对XGBoost** : 比较航班对

##### 3.2.3 列表方法

* [ ] **ListNet** : 直接列表优化
* [ ] **ListMLE** : 最大似然估计
* [ ] **GroupNet** : 分组神经排名

#### 3.3 深度学习模型

* [ ] **深度神经网络** : 多层感知器
* [ ] **基于Transformer** : 航班集合注意力机制
* [ ] **图神经网络** : 路线和航空公司关系
* [ ] **嵌入模型** : 学习用户/航班表示

### 阶段4: 模型训练与验证

#### 4.1 交叉验证策略

* [ ] **基于组的CV** : 按 `ranker_id` 分割防止泄露
* [ ] **时间CV** : 尊重基于时间的排序
* [ ] **分层CV** : 维持路线/用户分布平衡

#### 4.2 训练考虑因素

* [ ] 处理类别不平衡（每组1个选择）
* [ ] 实现分组损失函数
* [ ] 使用排名特定优化器
* [ ] 应用正则化技术

#### 4.3 超参数优化

* [ ] 传统ML模型网格搜索
* [ ] 复杂模型贝叶斯优化
* [ ] 早停策略
* [ ] 学习率调度

### 阶段5: 评估与验证

#### 5.1 指标实现

* [ ] **主要** : HitRate@3 计算
* [ ] **次要** : 平均倒数排名 (MRR)
* [ ] **诊断** : Precision@K, Recall@K
* [ ] **业务** : 转化率模拟

#### 5.2 错误分析

* [ ] 按路线类型分析失败案例
* [ ] 检查用户细分性能
* [ ] 调查定价敏感性模式
* [ ] 研究时间偏好不匹配

#### 5.3 模型可解释性

* [ ] 特征重要性分析
* [ ] 个别预测的SHAP值
* [ ] 业务规则提取
* [ ] 反事实分析

### 阶段6: 高级技术

#### 6.1 集成方法

* [ ] **堆叠** : 组合多种模型类型
* [ ] **混合** : 预测加权平均
* [ ] **排名平均** : 直接组合排名
* [ ] **条件集成** : 路线特定模型

#### 6.2 领域特定增强

* [ ] **路线聚类** : 相似路线模式建模
* [ ] **季节性调整** : 基于时间的模型变化
* [ ] **企业政策集成** : 政策感知排名
* [ ] **实时特征** : 市场条件指标

#### 6.3 高级特征工程

* [ ] **交互特征** : 复杂特征组合
* [ ] **自动特征选择** : 递归消除
* [ ] **多项式特征** : 非线性关系
* [ ] **基于聚类的特征** : 用户/路线细分

### 阶段7: 生产与提交

#### 7.1 最终模型选择

* [ ] 交叉验证性能比较
* [ ] 不同分割的稳定性分析
* [ ] 计算效率评估
* [ ] 鲁棒性测试

#### 7.2 提交准备

* [ ] 将概率转换为排名
* [ ] 验证排名排列
* [ ] 确保格式正确
* [ ] 测试提交文件完整性

#### 7.3 模型文档

* [ ] 特征工程流水线
* [ ] 模型架构详情
* [ ] 训练程序文档
* [ ] 性能分析总结

## 关键技术挑战

### 1. 排名问题复杂性

* **挑战** : 将分类/回归转换为排名
* **解决方案** : 使用排名感知损失函数和评估指标

### 2. 组大小变化

* **挑战** : 处理10-1000+选项的组
* **解决方案** : 可扩展模型和高效排名算法

### 3. 稀疏信号

* **挑战** : 每组只有1个正例
* **解决方案** : 谨慎采样和增强策略

### 4. 业务逻辑集成

* **挑战** : 捕获复杂商务旅行偏好
* **解决方案** : 领域专业知识和可解释特征

### 5. 计算效率

* **挑战** : 具有复杂特征的大数据集
* **解决方案** : 高效算法和并行处理

## 成功指标与里程碑

### 短期目标 (第1-2周)

* [ ] 完成数据探索和理解
* [ ] 实现基线模型
* [ ] 建立评估流水线
* [ ] 达到 HitRate@3 > 0.30

### 中期目标 (第3-4周)

* [ ] 高级特征工程
* [ ] 实现多种ML方法
* [ ] 交叉验证框架
* [ ] 达到 HitRate@3 > 0.45

### 长期目标 (最后几周)

* [ ] 集成方法实现
* [ ] 高级模型调优
* [ ] 生产就绪流水线
* [ ] 目标 HitRate@3 > 0.55

## 资源需求

### 计算资源

* **内存** : 16GB+ RAM 用于数据处理
* **存储** : 100GB+ 用于原始数据和特征
* **计算** : 深度学习模型推荐GPU

### 软件栈

* **数据处理** : pandas, numpy, polars
* **ML库** : scikit-learn, xgboost, lightgbm
* **深度学习** : tensorflow/pytorch, transformers
* **可视化** : matplotlib, seaborn, plotly
* **排名** : rankpy, xlearn, tensorflow-ranking

## 风险管理

### 技术风险

* **数据质量问题** : 实施强健验证
* **过拟合** : 强交叉验证策略
* **计算限制** : 高效算法和采样
* **模型复杂性** : 从简单开始，逐步增加复杂性

### 业务风险

* **领域误解** : 持续与业务逻辑验证
* **指标优化** : 专注于业务相关指标
* **泛化能力** : 在多样化场景中测试

该框架为处理航班排名竞赛提供了全面的路线图，平衡了技术严谨性和实际业务考虑。
